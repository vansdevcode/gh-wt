#!/bin/bash
set -e

# Get database name from environment variable
DB_NAME="myapp_$(echo "$WT_BRANCH" | sed 's/[^a-zA-Z0-9]/_/g' | tr '[:upper:]' '[:lower:]')"

echo "ðŸ—‘ï¸  Deleting database: $DB_NAME"
mysql -uroot -e "DROP DATABASE IF EXISTS \`$DB_NAME\`;" 2>/dev/null || {
  echo "âš ï¸  Warning: Could not delete database $DB_NAME"
}

echo "ðŸ”— Unlinking from Laravel Herd..."
cd "$WT_DIRECTORY" && herd unlink 2>/dev/null || true

echo "âœ… Worktree cleanup complete!"
